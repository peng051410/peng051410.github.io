<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Annotation | I'm company</title><meta name=keywords content><meta name=description content="Everyone is a company."><meta name=author content="Me"><link rel=canonical href=http://blog.imcompany.cn/tags/annotation/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://blog.imcompany.cn/tags/annotation/index.xml title=rss><link rel=alternate hreflang=en href=http://blog.imcompany.cn/tags/annotation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://blog.imcompany.cn/tags/annotation/"><meta property="og:site_name" content="I'm company"><meta property="og:title" content="Annotation"><meta property="og:description" content="Everyone is a company."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="http://blog.imcompany.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://blog.imcompany.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Annotation"><meta name=twitter:description content="Everyone is a company."></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=http://blog.imcompany.cn/ accesskey=h title="Home (Alt + H)"><img src=http://blog.imcompany.cn/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://blog.imcompany.cn/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://blog.imcompany.cn/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://blog.imcompany.cn/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/peng051410/today_i_learn title=Til><span>Til</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=http://blog.imcompany.cn/>Home</a>&nbsp;Â»&nbsp;<a href=http://blog.imcompany.cn/tags/>Tags</a></div><h1>Annotation
<a href=/tags/annotation/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@Conditional</h2></header><div class=entry-content><p>æ³¨è§£è¯´æ˜ @Conditional æ˜¯ Spring æä¾›çš„ç”¨äºåˆ¤æ–­æ˜¯å¦å¯¹ Bean æ³¨å…¥çš„æ¡ä»¶æ³¨è§£(åœ¨4.0åç‰ˆæœ¬å¼•å…¥)ï¼Œåªæœ‰æ»¡è¶³äº†æ‰€æœ‰çš„æ¡ä»¶ï¼Œä¸€ä¸ª bean æ‰ä¼šè¢«æ³¨å†ŒæˆåŠŸå¹¶ä½¿ç”¨ã€‚æ­¤æ³¨è§£å¯æ ‡æ³¨åœ¨ç±»ä¸Šã€å…ƒæ³¨è§£ä¸Šã€@Beanæ–¹æ³•ä¸Šï¼Œé€šå¸¸ä¸ @Configuration æ³¨è§£é…åˆä½¿ç”¨ï¼Œæ ‡è¯†åœ¨ @Configuration æ³¨è§£ä¸Šçš„ @Conditional ä¼šå½±å“æ­¤é…ç½®ç±»çš„æ‰€æœ‰ @Bean æ³¨è§£æ–¹æ³•ã€@Import æ³¨è§£å’Œ@ComponentScan æ³¨è§£ã€‚å¦éœ€æ³¨æ„ @Conditional æ³¨è§£ä¸æ”¯æŒç»§æ‰¿
å¯¹äºæ ‡æ³¨åœ¨å…ƒæ³¨è§£ä¸Šçš„æ ·ä¾‹ï¼Œå¯æŸ¥çœ‹ SpringBoot é¡¹ç›®ä¸‹çš„ org.springframework.boot.autoconfigure.condition åŒ…ä»¥ ConditionalOn å¼€å¤´çš„ç±»
æ³¨è§£å±æ€§ æ­¤æ³¨è§£åªæœ‰ä¸€ä¸ªå±æ€§ value ï¼Œè¿”å›ç±»å‹ä¸º Class æ•°ç»„ï¼Œå®ƒç”¨æ¥é…ç½®æ‰€æœ‰çš„ Condition ç±»ä¿¡æ¯
Condition æ˜¯ Spring æä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº† matches æ–¹æ³•æ¥æä¾›åˆ¤æ–­çš„ä¾æ®é€»è¾‘ï¼Œå¯¹äºå…¶å‚æ•° ConditionContext æä¾›äº†ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
æµ‹è¯•ä»£ç  @Configuration @ComponentScan(basePackages = "cn.imcompany.bean.condition") public class MyConfiguration { @Bean @ConditionalOnDate public MyBean myBean() { return new MyBean(); } @Bean public MyBean2 myBean2() { return new MyBean2(); } @Bean @Conditional(ConfigPropertyCondition.class) public MyBean5 myBean5() { return new MyBean5(); } } @Configuration @Conditional(ConfigPropertyCondition.class) public class MyConfigConfiguration { @Bean public MyBean3 myBean3() { return new MyBean3(); } @Bean public MyBean4 myBean4() { return new MyBean4(); } } public class MyDateCondition implements Condition { @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) { LocalDateTime now = LocalDateTime.now(); int minute = now.getMinute(); return minute % 2 == 0; // æ¯éš”ä¸¤åˆ†é’Ÿæ»¡è¶³æ¡ä»¶ } } @Retention(java.lang.annotation.RetentionPolicy.RUNTIME) @Target({java.lang.annotation.ElementType.TYPE, java.lang.annotation.ElementType.METHOD}) @Documented @Conditional(MyDateCondition.class) public @interface ConditionalOnDate { } public class ConfigPropertyCondition implements Condition { @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) { return "true".equals(System.getProperty("my.config.property")); } } public class Main { public static void main(String[] args) { System.setProperty("my.config.property", "true"); AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MyConfiguration.class); for (String beanDefinitionName : context.getBeanDefinitionNames()) { System.out.println("beanDefinitionName = " + beanDefinitionName); } } } æºç é˜…è¯» å¯¹äº Configuration ç±»æ¡ä»¶å¤„ç†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š
...</p></div><footer class=entry-footer><span title='Created: 2025-06-18 15:00:00 +0800 CST'>2025-06-18</span>&nbsp;Â·&nbsp;<span title='Modified: 2025-06-23 11:33:04 +0800 CST'> (ğŸŒŸUpdated: 2025-06-23)</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>333 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@Conditional" href=http://blog.imcompany.cn/post/spring-@conditional/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@Bean</h2></header><div class=entry-content><p>æ³¨è§£è¯´æ˜ @Bean æ˜¯Springçš„ä¸€ä¸ªæ ¸å¿ƒæ³¨è§£ï¼Œé€šå¸¸ä¸ @Configuration æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•è¿”å›çš„å®ä½“åšä¸ºSpringç®¡ç†çš„ä¸€ä¸ªBeanï¼Œé€šè¿‡æ­¤æ³¨è§£å¯ä»¥ä½¿ç”¨JAVAçš„ç‰¹æ€§é…ç½®å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹Beanåå­—ä¸ºæ–¹æ³•åï¼Œä¹Ÿæ”¯æŒé€šè¿‡å±æ€§è¿›è¡Œé…ç½®
å±æ€§è¯´æ˜ name è‡ªå®šä¹‰Beançš„åç§°ï¼Œæ”¯æŒé…ç½®å¤šä¸ªåç§°ï¼Œä¸é…ç½®é»˜è®¤ä¸ºæ–¹æ³•åç§°
initMethod é…ç½®å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨Beanå®ä¾‹åŒ–è¢«è°ƒç”¨ï¼Œé»˜è®¤ä¸ºç©º
destroyMethod é…ç½®å®ä¾‹é”€æ¯æ–¹æ³•ï¼Œé»˜è®¤å€¼ä¸º (inferred) å³ä¼šæ ¹æ®è¿”å›çš„Beanå°è¯•æŸ¥æ‰¾è¯†åˆ«å¯¹è±¡çš„é”€æ¯æ–¹æ³• close æˆ–è€… shutdown(é™åˆ¶åªæŸ¥æ‰¾publicæ— å‚æ–¹æ³•)ï¼Œå¦‚è¿”å›ä¸€ä¸ª BasicDataSource å®ä¾‹ï¼Œä¼šé»˜è®¤æŸ¥æ‰¾ close() æ–¹æ³•è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœä¸æƒ³Springè¿›è¡Œæ­¤æ“ä½œï¼Œéœ€è¦å°†æ­¤å€¼è®¾ç½®ä¸º: destroyMethod="" (æ­¤é…ç½®å¯¹ DisposableBean å›è°ƒä¸ç”Ÿæ•ˆ)
æ ¸å¿ƒé€»è¾‘åœ¨ DisposableBeanAdapter#inferDestroyMethodsIfNecessary() æ–¹æ³•ä¸­
ä¸å…¶å®ƒæ³¨è§£çš„å…³è” @Bean ä¸XMLé…ç½®æ–¹å¼ä¸­çš„ &lt;bean> æ ‡ç­¾ä¸åŒï¼Œå®ƒä½¿ç”¨ä¸å…¶å®ƒæ³¨è§£ç»„åˆçš„æ–¹å¼æ¥å®ç°ç±»å‹ Scope æˆ–è€…æ‡’åŠ è½½çš„åŠŸèƒ½ï¼Œå…·ä½“å¯ç»„åˆæ³¨è§£å¦‚ä¸‹ï¼š
@Profile @Scope @Lazy @DepednsOn @Primary @Order @Description(ç»™æ³¨è§£beanè¯¦ç»†æè¿°ï¼Œæ­¤æ³¨è§£çš„å€¼ä¼šä¿å­˜åœ¨ BeanDefinition å®ä¾‹ä¸Š) @Conditional æ¥å£é»˜è®¤æ–¹æ³•å®šä¹‰Bean Spring æ”¯æŒåœ¨æ¥å£ä¸­ä½¿ç”¨é»˜è®¤æ–¹æ³•çš„æ–¹å¼è¿›è¡Œbeançš„å®šä¹‰ï¼Œæ–¹ä¾¿å­ç±»é…ç½®ç±»ç›´æ¥å¤ç”¨ï¼Œç¤ºä¾‹ä»£ç :
public interface BaseConfig { @Bean default MyBean3 myBean3() { return new MyBean3(); } } @Configuration public class AppConfig implements BaseConfig { } æºç é˜…è¯» Beanæ³¨è§£é…ç½®å®ä¾‹åŒ– ç”±äº@Beané€šå¸¸ä¸@Configuration ä¸€èµ·ä½¿ç”¨ï¼Œæ ¸å¿ƒé€»è¾‘åœ¨ refresh é˜¶æ®µï¼Œå®šä½ä»£ç å‘ç°åœ¨ ConfigurationClassParser#doProcessConfigurationClass() æ–¹æ³•è¿›è¡Œå¯¹ @Bean æ ‡è¯†æ–¹æ³•çš„è§£æ
...</p></div><footer class=entry-footer><span title='Created: 2025-06-17 17:56:39 +0800 CST'>2025-06-17</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>191 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@Bean" href=http://blog.imcompany.cn/post/spring-@bean/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@Import</h2></header><div class=entry-content><p>æ³¨è§£è¯´æ˜ @Import æ³¨è§£ç”¨äºæ ‡è¯†å¤šä¸ªéœ€è¦å¯¼å…¥çš„ Component ç±»ï¼Œæ”¯æŒå¯¼å…¥ @Configuration ç±»ï¼Œ ImportSelector ä¸ ImportBeanDefinitionRegistrar å®ç°ï¼Œä¸ AnnotationConfigApplicationContext.register() æ–¹æ³•å®ç°çš„åŠŸèƒ½ç±»ä¼¼ã€‚æ­¤æ³¨è§£å¸¸è§çš„å®è·µæ–¹å¼æ˜¯æ ‡æ³¨åœ¨ EnableXXXX æ³¨è§£ä¸Šï¼Œç”¨äºå¼€å¯æŸäº›åŠŸèƒ½ï¼Œåœ¨å¼€å¯åŠŸèƒ½æ—¶å°±éœ€è¦é€šè¿‡ @Import æ³¨è§£æ¥é€‰æ‹©å¯¼å…¥å“ªäº›ç±»çš„å®šä¹‰
å±æ€§è¯´æ˜ æ­¤æ³¨è§£åªæœ‰ä¸€ä¸ªå±æ€§ valueï¼Œè¿”å› Class[] ï¼Œç”¨äºæ ‡è¯†å¯¼å…¥çš„ç±»
Classç±»å‹ @Configurationæ ‡è¯†çš„ç±» å¯¹äºä¸åŒåŠŸèƒ½çš„é…ç½®ä½¿ç”¨å¤šä¸ª @Configuration æ ‡è¯†ï¼Œç”±ä¸€ä¸ªç±»æ¥ Import å¦ä¸€ä¸ª ç±»çš„é…ç½®ï¼Œæ¥è¾¾åˆ°å¤ç”¨çš„æ•ˆæœ
@Configuration public class MyConfig2 { @Bean public MyBeanD myBeanD() { return new MyBeanD(); } } @Configuration @Import({MyConfig2.class}) public class MyConfig { } ImportSelectorå®ç°ç±» æ‰€æœ‰çš„ ImportSelector å®ç°éƒ½éœ€è¦å®ç°å®ƒçš„ selectImports æ–¹æ³•ï¼Œæ¥è¿”å›è¦å¯¼å…¥çš„beanç±»åç§°é›†åˆ public class MyImportSelector implements ImportSelector { @Override public String[] selectImports(AnnotationMetadata importingClassMetadata) { return new String[]{MyBeanA.class.getName()}; } } åœ¨ ImportSelector å¯ä»¥é€šè¿‡Awareæˆ–è€…æ„é€ å™¨æ³¨å…¥çš„æ–¹å¼ä½¿ç”¨ Springä¸­çš„å®¹å™¨ç»„ä»¶ï¼š
...</p></div><footer class=entry-footer><span title='Created: 2025-06-17 17:32:55 +0800 CST'>2025-06-17</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>245 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@Import" href=http://blog.imcompany.cn/post/spring-@import/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@Value</h2></header><div class=entry-content><p>æ³¨è§£è¯´æ˜ @Value æ˜¯Springæä¾›ç”¨äºå¤„ç†å±æ€§ä¸è¡¨è¾¾å¼æ³¨å…¥çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨åœ¨å­—æ®µã€æ–¹æ³•æˆ–æ„é€ å™¨çš„å‚æ•°ä¸Šï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€è§£æSpringMVCä¸­çš„æ–¹æ³•å‚æ•°ã€‚æ”¯æŒæ³¨å…¥æ–¹å¼ï¼š
ç›´æ¥æ³¨å…¥å¦‚: @Value(â€œtestâ€) ${my.app.myProp} å±æ€§æ³¨å…¥ #{systemProperties.myProp} SpELè¡¨è¾¾å¼ å®ƒæä¾›äº†ä¸åŒçš„é…ç½®æº(å±æ€§æ–‡ä»¶ã€ç³»ç»Ÿå±æ€§)çš„æ³¨å…¥
æ³¨è§£å±æ€§ @Value æ³¨è§£åªæœ‰ä¸€ä¸ªå±æ€§ value ï¼Œè¡¨ç¤ºè¦æ³¨å…¥çš„å®é™…å€¼çš„è¡¨è¾¾å¼ï¼Œæ”¯æŒå±æ€§ä¸SpELè¡¨è¾¾å¼ä¸¤ç§æ–¹å¼ æµ‹è¯•ä»£ç  ä»¥ä¸‹æµ‹è¯•ä»£ç MyControllerçš„usernameçš„æ³¨å…¥å€¼ä¸º: tomyliï¼Œè€Œä¸æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„admin
@Controller public class MyController { @Value("${USER}") @Getter private String username; } @Configuration @ComponentScan(basePackages = "cn.imcompany.bean.autowired") @PropertySource("classpath:application.properties") public class MyConfiguration { } public class Main { public static void main(String[] args) { AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MyConfiguration.class); MyController myController = context.getBean(MyController.class); System.out.println(myController.getUsername()); // tomyi } } application.propertiesé…ç½®æ–‡ä»¶ USER=admin æºç é˜…è¯» @Value æ³¨è§£çš„å¤„ç†ç”± AutowiredAnnotationBeanPostProcessor ç±»è´Ÿè´£ï¼Œä¸å¤„ç† @Autowired æ³¨è§£çš„ç±»ä¸ºåŒä¸€ä¸ªPostProcessorã€‚ä¸»è¦çš„å¤„ç†é€»è¾‘å®ç°åœ¨ DefaultListableBeanFactory#doResolveDependency æ–¹æ³•ï¼Œå¯¹äº @Valueæ³¨è§£çš„å¤„ç†ä¸»è¦é›†ä¸­åœ¨ç¬¬2æ­¥ï¼Œè§£æ@Valueçš„æ“ä½œä¸»è¦åˆ†ä¸º3æ­¥ ...</p></div><footer class=entry-footer><span title='Created: 2025-06-10 16:00:00 +0800 CST'>2025-06-10</span>&nbsp;Â·&nbsp;<span title='Modified: 2025-06-19 14:13:56 +0800 CST'> (ğŸŒŸUpdated: 2025-06-19)</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>170 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@Value" href=http://blog.imcompany.cn/post/spring-@value/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@Autowireid</h2></header><div class=entry-content><p>æ³¨è§£è¯´æ˜ @Autowired æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨è£…è½½æ„é€ å™¨ã€å­—æ®µã€setæ–¹æ³•ã€é…ç½®æ–¹æ³•ä¸Šçš„ä¾èµ–ï¼Œå®ƒæ˜¯ JSR-330 @Inject æ³¨è§£çš„æ›¿ä»£ï¼Œæ”¯æŒé…ç½® ä¾èµ–æ˜¯å¦å¿…é¡» é€‰é¡¹
å±æ€§è¯´æ˜ æ­¤æ³¨è§£åªæœ‰ä¸€ä¸ªå±æ€§ required ï¼Œé»˜è®¤ä¸º true è¡¨ç¤ºå¾…æ³¨å…¥ç»„ä»¶å¿…é¡»å­˜åœ¨
æ³¨è§£æ³¨å…¥è§„åˆ™è¯´æ˜ æ„é€ å™¨æ³¨å…¥ å¦‚æœä¸€ä¸ªç±»å£°æ˜äº†å¤šä¸ªæ„é€ å™¨ä¸”æ²¡æœ‰ä¸€ä¸ªæ˜¾å¼æ ‡æ³¨ @Autowiredï¼Œåˆ™Springä¼šä½¿ç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•è¿›è¡Œè£…è½½ å¦‚æœä¸€ä¸ªç±»åªå£°æ˜äº†ä¸€ä¸ªæ„é€ å™¨ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ ‡æ³¨ @Autowired æ³¨è§£å®ƒéƒ½ä¼šè¢«ç›´æ¥ä½¿ç”¨ å¤šå‚æ•°å¯ä»¥é…ç½®å¤šä¸ªrequiredå±æ€§ï¼Œå¯¹äºå¯é€‰æ³¨å…¥ï¼Œå¯ä»¥å£°æ˜ä¸º Java8 çš„ Optional ç±»å‹ å¯¹äºå¯é€‰æ³¨å…¥ä¹Ÿå¯ä»¥ä½¿ç”¨ JSR-305 çš„ javax.annotation.Nullable æ³¨è§£
å­—æ®µæ³¨å…¥ å­—æ®µåœ¨æ„é€ å™¨ä¹‹åï¼Œé…ç½®æ–¹æ³•æ³¨å…¥ä¹‹å‰è¿›è¡Œè‡ªåŠ¨æ³¨å…¥
å­—æ®µæ³¨å…¥æ”¯æŒç»„ä»¶è‡ªå¼•ç”¨(self references)
æ–¹æ³•æ³¨å…¥ æ–¹æ³•æ³¨å…¥ä¸é™åˆ¶æ–¹æ³•åä¸å‚æ•°ä¸ªæ•°ï¼Œæ‰€æœ‰å‚æ•°ä¼šè¢«Springè¿›è¡ŒåŒ¹é…æ³¨å…¥
å‚æ•°æ³¨å…¥ ç›®å‰åªåœ¨ spring-test æ¨¡å—ä¸­æœ‰æ•ˆï¼Œå…¶å®ƒåœ°æ–¹ä½¿ç”¨ä¼šè¢«å¿½ç•¥
æ•°ç»„/é›†åˆæ³¨å…¥ Springé€šè¿‡åŒ¹é…æ•°ç»„/é›†åˆçš„å€¼è¿›è¡Œæ³¨å…¥ï¼ŒMapçš„keyå¿…é¡»ä¸ºStringç±»å‹ï¼Œæ”¯æŒé›†åˆä¸­å…ƒç´ çš„Orderé…ç½®
ä¸æ”¯æŒ BeanPostProcessor æˆ–è€… BeanFactoryPostProcessor å› ä¸ºçœŸå®çš„æ³¨å…¥åŠ¨ä½œå‘ç”Ÿåœ¨ BeanPostProcessor é˜¶æ®µï¼Œæ‰€ä»¥ä¸èƒ½åœ¨ BeanPostProcessor æˆ–è€… BeanFactoryPostProcessor ä¸­ä½¿ç”¨æ­¤æ³¨è§£
æºç é˜…è¯» åœ¨Springä¸­ï¼Œå¤„ç† @Autowired æ³¨è§£å¯¹åº”çš„ç±»ä¸º AutowiredAnnotationBeanPostProcessor ï¼Œåˆæ˜¯ä¸€ä¸ªBeanåç½®å¤„ç†å™¨
å¯¹äºæ­¤ç±»ï¼Œéœ€è¦å…³æ³¨å…¶å®ç°çš„ä¸¤ä¸ªæ¥å£ç±» MergedBeanDefinitionPostProcessor (è¿è¡Œæ—¶åˆå¹¶Beançš„å®šä¹‰å›è°ƒæ¥å£)å’Œ InstantiationAwareBeanPostProcessor (åœ¨Beanå®ä¾‹åŒ–å‰åè¿›è¡Œå¤„ç†åç½®å¤„ç†å™¨)
MergedBeanDefinitionPostProcessor ä¸»è¦æ˜¯ä¸ºäº†åœ¨çœŸæ­£beanå®ä¾‹åŒ–å‰å‡†å¤‡ç¼“å­˜çš„beanå…ƒæ•°æ® InstantiationAwareBeanPostProcessor Beanå®ä¾‹åŒ–å›è°ƒæ¥å£ï¼Œé€šå¸¸ç”¨äºä¸ºbeanåˆ›å»ºä»£ç† æµ‹è¯•ä»£ç  @Service public class MyService { } @Controller public class MyController { @Autowired MyService myService; public void showService() { System.out.println("myService = " + myService); } } @Configuration @ComponentScan(basePackages = "cn.imcompany.bean.autowired") public class MyConfiguration { } public class Main { public static void main(String[] args) { AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MyConfiguration.class); MyController myController = context.getBean(MyController.class); myController.showService(); } } å…ƒæ•°æ®æ”¶é›† è°ƒç”¨æ ˆä¿¡æ¯å¦‚ä¸‹ï¼š
...</p></div><footer class=entry-footer><span title='Created: 2025-06-06 16:00:00 +0800 CST'>2025-06-06</span>&nbsp;Â·&nbsp;<span title='Modified: 2025-06-19 11:14:05 +0800 CST'> (ğŸŒŸUpdated: 2025-06-19)</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>267 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@Autowireid" href=http://blog.imcompany.cn/post/spring-@autowired/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@CompnentScan</h2></header><div class=entry-content><p>æ³¨è§£è¯´æ˜ @ComponentScan æ³¨è§£æ˜¯Spring æä¾›çš„å¯¹ç»„ä»¶è¿›è¡Œæ‰«æçš„æ³¨è§£æŒ‡ä»¤ï¼Œé€šå¸¸ä¸ @Configuration æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œæ”¯æŒåœ¨ç±»ä¸Šé‡å¤æ ‡æ³¨
æ³¨è§£èƒ½åšä»€ä¹ˆï¼Ÿ æ­¤æ³¨è§£æ”¯æŒä»¥ä¸‹é‡è¦ç‰¹æ€§:
è‡ªå®šä¹‰æ‰«æçš„åŒ…èŒƒå›´ é…ç½®åŒ…å«æ‰«æç»„ä»¶çš„è¿‡æ»¤å™¨ é…ç½®æ’é™¤ç»„ä»¶çš„è¿‡æ»¤å™¨ æ˜¯å¦ä½¿ç”¨é»˜è®¤è¿‡æ»¤å™¨ æ˜¯å¦é…ç½®æ‡’åŠ è½½ æºç åˆ†æ ç”±äºæ­¤æ³¨è§£é€šå¸¸ä¸ @Configuration æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œå…¶è§£æçš„ä¸»è¦é€»è¾‘éƒ½æ˜¯åœ¨ refresh é˜¶æ®µçš„ invokeBeanFactoryPostProcessors æ–¹æ³•ä¸­ï¼Œæœ€ç»ˆä¼šå®šä½åˆ° ConfigurationClassParser#doProcessConfigurationClass() æ–¹æ³•ä¸­ï¼Œåœ¨æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°å¯¹ ComponentScan æ³¨è§£çš„æ“ä½œé€»è¾‘äº†
å¯¹æ³¨è§£å±æ€§çš„è§£æ æ‰€æœ‰å¯¹å±æ€§çš„è§£æéƒ½åœ¨ ComponentScanAnnotationParser#parse() æ–¹æ³•ä¸­è¿›è¡Œï¼Œæ­¤æ–¹æ³•ä¸­ä¼šåˆ›å»ºä¸€ä¸ª ClassPathBeanDefinitionScanner å®ä¾‹scannerï¼Œæ­¤å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šå¯¹é»˜è®¤çš„Filterè¿›è¡ŒåŠ è½½
å¤„ç†é»˜è®¤Filterä¸»è¦æ˜¯ JSR-250 ä¸ JSR-330 API å¢åŠ çš„æ³¨è§£
ç„¶åä¼šæŠŠé…ç½®çš„ includeFilter å’Œ excludeFilter è®¾ç½®åˆ° scanner ä¸­ï¼Œæ¥ç€ä¼šå¯¹ basePackage æ‰«æåŒ…å±æ€§è¿›è¡Œè§£æé…ç½®ï¼Œå¦‚æœé…ç½®äº†å°±æ·»åŠ ï¼Œæ²¡æœ‰é…ç½®ï¼Œé»˜è®¤å°±ä½¿ç”¨ @ComponentScan æ³¨è§£æ ‡æ³¨ç±»æ‰€åœ¨çš„åŒ…è·¯å¾„ã€‚è§£æå®Œæ³¨è§£å±æ€§åï¼Œå°±å¼€å§‹äº†çœŸæ­£çš„æ‰«ææ“ä½œ
æ‰«ææ“ä½œ æ‰«ææ“ä½œç”± ClassPathBeanDefinitionScanner#doScan() æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œæ­¤æ–¹æ³•ä¼šè°ƒç”¨ findCandidateComponents() æ–¹æ³•åœ¨ç»™å®šçš„åŒ…ä¸‹æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç»„ä»¶ï¼ŒæŸ¥æ‰¾çš„ä»»åŠ¡ç”± scanCandidateComponents() è¿›è¡Œï¼Œè¯¥æ–¹æ³•è°ƒç”¨ isCandidateComponent() æ–¹æ³•ï¼Œæ ¹æ®è§£æçš„includeFilterå’ŒexcludeFilter æ¥é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„ç»„ä»¶
è¿™æ ·æ‰«æåˆ°æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„Beanåï¼Œä¼šæ¥ç€å¯¹è¿™äº›Beanè¿›è¡Œparseæ“ä½œï¼Œç›´åˆ°æ³¨è§£å†æ— å…¶å®ƒä¾èµ–
æ³¨å†ŒBean æ‰«æå®Œæ‰€æœ‰Beanåï¼Œä¼šè°ƒç”¨ checkCandidate() æ–¹æ³•è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å½“å‰è¦æ³¨å†Œçš„Beanæ˜¯å¦ä¸å·²ç»æ³¨å†Œè¿‡çš„Beançš„å®šä¹‰æ˜¯å¦å…¼å®¹ï¼Œå¦‚æœå†²çªä¼šæŠ¥ ConflictingBeanDefinitionException ã€‚æ£€æŸ¥æ²¡é—®é¢˜åï¼Œä¼šè°ƒç”¨ registerBeanDefinition() æ–¹æ³•å¯¹Beanè¿›è¡Œæ³¨å†Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ¶‰åŠåˆ°Springå…¶å®ƒçš„ç”Ÿå‘½å‘¨æœŸäº†ï¼ˆè¿™ä¸ªåç»­ä¸“é—¨å­¦ä¹ æ€»ç»“ï¼‰ï¼Œå¯¹äº@ComponentScan ç»„ä»¶æ¥è¯´å·²ç»å®Œæˆäº†å®ƒçš„ä½¿å‘½
æ€»ç»“ æœ€åä»¥æ³¨è§£è§£æè¿‡ç¨‹ä¸­çš„æ¶‰åŠçš„æ ¸å¿ƒç±»åšä¸€ä¸‹æ€»ç»“
å¸¸è§é—®é¢˜ è°ƒæ•´åŒ…ç»“æ„åä¸€äº›@Beané…ç½®æ‰«æä¸åˆ°äº† è°ƒç”¨å¯åŠ¨ç±»çš„åŒ…è·¯å¾„ä¸ºæœ€å¤–å±‚ï¼Œè¿™æ ·å¯ä»¥æ‰«æå½“å‰åŒ…åŠå­åŒ…çš„é…ç½® é»˜è®¤åªæ‰«æå½“å‰æ ‡æ³¨æ³¨è§£çš„åŒ…ï¼Œå¯ä»¥é€šè¿‡é…ç½® basePackage å±æ€§æŒ‡å®šæ‰«æè·¯å¾„ï¼Œé…ç½®åé»˜è®¤çš„æ‰«æè·¯å¾„å°±ä¸ç”Ÿæ•ˆäº† å¦‚ä½•å°†æœªé…ç½®Springç›¸å…³ç»„ä»¶æ³¨è§£çš„Beançº³å…¥Springç®¡ç†? å¯ä»¥é€šè¿‡é…ç½® ComponentScançš„includeFilter æ¥å®ç°
...</p></div><footer class=entry-footer><span title='Created: 2025-05-15 16:29:33 +0800 CST'>2025-05-15</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>99 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@CompnentScan" href=http://blog.imcompany.cn/post/spring-componentscan/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Springå­¦ä¹ ä¹‹@Configuration</h2></header><div class=entry-content><p>@Configurationæ˜¯ä»€ä¹ˆï¼Ÿ @Configuration æ˜¯ Springæä¾›çš„ä¸€ä¸ªç”¨äºé…ç½®ä¸å£°æ˜Beanä¸ç›¸åº”Beanä¹‹é—´ä¾èµ–çš„æ³¨è§£ï¼Œæ ¹æ®æ–‡æ¡£æè¿°ï¼Œæ­¤æ³¨è§£é€šå¸¸ç”± AnnotationConfigApplicationContext ä¸Šä¸‹æ–‡è¿›è¡Œå¯åŠ¨åŠ è½½
@Configurationèƒ½åšä»€ä¹ˆï¼Ÿ å…ˆçœ‹ä¸€ä¸‹æ­¤æ³¨è§£çš„å£°æ˜ï¼Œåœ¨æ­¤æ³¨è§£ä¸Šæ ‡è¯†äº† @Component ï¼Œåˆ™è¯æ˜æ­¤æ³¨è§£æ˜¯ä¸€ä¸ª Componentï¼Œæ‹¥æœ‰ @Component æ³¨è§£çš„åŸºç¡€èƒ½åŠ›(å¯ä»¥è¢«Springå®¹å™¨è‡ªåŠ¨æ‰«æä¸åŠ è½½)
ä¸Šå›¾æ ‡è¯†äº†æ³¨è§£å¸¸ç”¨çš„é…ç½®æ–¹å¼ï¼Œåˆ†ç±»ä¸ºä»¥ä¸‹å‡ ç§
å±æ€§èµ„æºå¯¼å…¥ å¼•å…¥å…¶å®ƒé…ç½®ç±»çš„é…ç½® Valueæ³¨å…¥ Springå®¹å™¨ç»„ä»¶æ³¨å…¥ æ”¯æŒProfileé…ç½® æ³¨è§£å±æ€§ åœ¨Spring5.xç‰ˆæœ¬ä¸­ï¼Œåªæ”¯æŒä¸¤ä¸ªå±æ€§é…ç½®
value é…ç½®æ³¨è§£çš„åç§°
proxyBeanMethods æ˜¯å¦ä»£ç†å¢å¼º(åŸºäºCGLIB)æ ‡è¯† @Bean çš„æ–¹æ³•ï¼Œé»˜è®¤ä¸ºtrueï¼Œä¿è¯å£°æ˜çš„beanæ˜¯å•ä¾‹å…±äº«çš„ï¼Œè€Œä¸æ˜¯æ¯ä¸€æ¬¡é€šè¿‡æ–¹æ³•è°ƒç”¨éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„
æ­¤å±æ€§çš„ä¸¤ä¸ªå€¼è¢«å®šä¹‰ä¸ºä¸¤ç§æ¨¡å¼
full æ¨¡å¼(å€¼ä¸ºtrue) lite æ¨¡å¼(å€¼ä¸ºfalse) æºç åˆ†æ @Configuration æ³¨è§£çš„è§£æç±»ä¸º ConfigurationClassPostProcessor ï¼Œæœ¬æ¬¡ä¸»è¦å…³æ³¨ä» AnnotationConfigApplicationContext å¯åŠ¨åçš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹ï¼Œ AnnotationConfigApplicationContext å¯åŠ¨åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ
å…ˆä¸Šä¸€å¼ ä¸‰ä¸ªé˜¶æ®µçš„æ¶‰åŠçš„ä¸»è¦ç±»ä¸è°ƒç”¨å…³ç³»å›¾ åˆå§‹åŒ– åˆå§‹åŒ–reader æ­¤è¿‡ç¨‹ä¼šå®ä¾‹åŒ– AnnotatedBeanDefinitionReader ç±»ï¼Œæ­¤ç±»åœ¨å®ä¾‹åŒ–æ—¶ä¼šè°ƒç”¨ AnnotationConfigUtils.registerAnnotationConfigProcessors æ¥æ³¨å†Œè§£æé…ç½®çš„Processorï¼Œå¦‚æœregistryä¸­æ²¡æœ‰åŒ…å« ConfigurationClassPostProcessor ç±»çš„å®šä¹‰ï¼Œåˆ™ä¼šæ–°newä¸€ä¸ª ConfigurationClassPostProcessor çš„Beanå®šä¹‰ç±»
æ•´ä½“è°ƒç”¨é“¾è·¯å¦‚ä¸‹ï¼š
åˆå§‹åŒ–scanner æ­¤è¿‡ç¨‹ä¼šå®ä¾‹åŒ–Beanå®šä¹‰æ‰«æå™¨ ClassPathBeanDefinitionScanner , åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸»è¦ä¼šè®¾ç½® Environment å’Œ ResourceLoader ç›¸å…³ä¿¡æ¯
æ³¨å†Œ æ³¨å†Œé˜¶æ®µä¸»è¦æ˜¯å¯¹æ ‡æ³¨äº† @Configuration ç±»(MyConfig)è¿›è¡Œæ³¨å†Œï¼Œä»¥ä¾¿Springå¯ä»¥æ­£å¸¸è¯†åˆ«ï¼Œä¸»è¦é€»è¾‘åœ¨ AnnotatedBeanDefinitionReader#doRegisterBean ä¸­ï¼Œæ­¤æ–¹æ³•ä¼šè°ƒç”¨ BeanDefinitionReaderUtils.registerBeanDefinition å¯¹æ­¤Beanè¿›è¡Œæ³¨å†Œ
è‡³æ­¤ï¼Œ @Configuration ç±»ä¿¡æ¯å°±æ³¨å†Œåˆ°äº† Spring å®¹å™¨ä¸­
...</p></div><footer class=entry-footer><span title='Created: 2025-05-09 11:40:11 +0800 CST'>2025-05-09</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>202 words</span>&nbsp;Â·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springå­¦ä¹ ä¹‹@Configuration" href=http://blog.imcompany.cn/post/spring-configuration/></a></article></main><footer class=footer><span>&copy; 2026 <a href=http://blog.imcompany.cn/>I'm company</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>