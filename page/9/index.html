<!doctype html><html lang=en dir=auto data-theme=auto><head><meta name=generator content="Hugo 0.154.5"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>I'm company</title><meta name=keywords content="Java,Tool,Emacs,Mac"><meta name=description content="Everyone is a company."><meta name=author content="Me"><link rel=canonical href=http://blog.imcompany.cn/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://blog.imcompany.cn/index.xml title=rss><link rel=alternate type=application/json href=http://blog.imcompany.cn/index.json title=json><link rel=alternate hreflang=en href=http://blog.imcompany.cn/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://blog.imcompany.cn/"><meta property="og:site_name" content="I'm company"><meta property="og:title" content="I'm company"><meta property="og:description" content="Everyone is a company."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="http://blog.imcompany.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://blog.imcompany.cn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="I'm company"><meta name=twitter:description content="Everyone is a company."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"I'm company","url":"http://blog.imcompany.cn/","description":"Everyone is a company.","logo":"http://blog.imcompany.cn/%3Clink%20/%20abs%20url%3E","sameAs":["https://x.com/","peng051410@126.com","https://github.com/peng051410"]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=http://blog.imcompany.cn/ accesskey=h title="Home (Alt + H)"><img src=http://blog.imcompany.cn/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://blog.imcompany.cn/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://blog.imcompany.cn/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://blog.imcompany.cn/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/peng051410/today_i_learn title=Til><span>Til</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Org-babel学习记录</h2></header><div class=entry-content><p>基础 匿名代码段 命名的代码块 命名的代码块与结果项是可以分开的，orgmode通过代码块的名称进行匹配
定义参数 参数变量根据对应语言表现方式不同 :var x=0
Header header多行书写便于阅读
内联代码段 4
常用命令 org-babel-execute-buffer 执行buffer的所有代码段</p></div><footer class=entry-footer><span title='2022-09-28 15:12:00 +0800 CST'>September 28, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>15 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Org-babel学习记录" href=http://blog.imcompany.cn/post/org-babel-study/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Org-anki, Org与Anki的完美结合</h2></header><div class=entry-content><p>Org-anki Org-anki是一个同步Org中note到Anki的Emacs包，它的实现非常简单灵活，文档书写体验好
安装 支持的note 基础note 基本的正反两面问答形式，在org中，heading表示问题，内容表示答案
* 我是问题 我就是答案了 填空型note 填空形式，处理格式为 {{…}}, 只关注heading，不关注内容
* 我是问题 {{c1::答案在这}} 嵌套型 其它也是基础型，但是这种功能让org note的组织更加友好，因为有时一个记忆点可能需要多种方式来实现
* 我是问题1 我是答案1 ** 我是问题1 我是问题1的另一种答案 上面的情况会在anki中创建两个基础的card，也就是两个记忆点，好用
常用命令 org-anki-sync-all 同步所有note到anki
org-anki-sync-entry 同步当前光标所属的entry到anki
org-anki-cloze-dwim 创建填空形式，要选中标题部分区域进行转换
org-anki-browse-entry 在Anki中浏览当前光标下entry的note信息
org-anki-import-deck 从Anki中导入，在Anki中已经存在部分note时，可以先导入到org中，再进行同步
org-anki-delete-entry 删除当前entry
org-anki-delete-all 删除所有entry</p></div><footer class=entry-footer><span title='2022-09-27 15:03:00 +0800 CST'>September 27, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>41 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Org-anki, Org与Anki的完美结合" href=http://blog.imcompany.cn/post/tools-org-anki/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Apollo不更新配置了？</h2></header><div class=entry-content><p>问题描述 近期改造服务调用，需要使用Apollo配置进行灵活切换，上线后发现有些机器配置生效，有些配置未生效，开发小伙伴反馈此问题发生有一段时间
问题排查 机器排查 对线上机器进行排查，发现有几台机器根本没有拉取新的应用配置
指定问题机器信息 进入到问题机器查看本地Apollo文件信息
... -rw-rw-r-- 1 mqq mqq 3429 May 19 15:32 main-webapp+default+CoopReader.baipai.switch.properties -rw-r--r-- 1 mqq mqq 1621 Jul 4 15:39 main-webapp+default+CoopReader.switcher.properties -rw-r--r-- 1 mqq mqq 89 Aug 26 11:18 main-webapp+default+CoopReader.personal.menu.properties -rw-r--r-- 1 mqq mqq 3958 Aug 26 15:45 main-webapp+default+CoopReader.common.config.propertie 可以看到文件的最新日期在8月26日
Apollo 服务的问题? 先前小伙伴反应问过运维相关问题，得到的结论是Apollo没有改动，且服务配置不是完全不可用，此方向排除
服务的问题? 从目前得到的信息可以确认是某几台机器上的Apollo client没有去拉取最新的配置信息
为什么没有拉取到最新配置? 先来梳理一下Apollo的使用流程:
业务对Apollo的访问都基于 L5 的方式 目前业务工程使用cloudlevel5.Protocol来获取L5的信息与Apollo Portal进行交互 &lt;dependency> &lt;groupId>com.yuewen&lt;/groupId> &lt;artifactId>userbase-l5-system&lt;/artifactId> &lt;version>1.0.3.Final&lt;/version> &lt;/dependency> 为什么业务机没有与Apollo portal交互? 怀疑与出问题的机器获取不到L5信息有关
问题猜测验证 大体知道问题出在哪了，下面就需要进行验证了。最简单的方式就是打印出Apollo的相关日志信息对猜测进行验证，但是目前业务的日志级别设置的 ERROR ，啥也看不到
修改业务日志级别? 现在需要打印aplllo相关的日志级别为 Info ，需要修改Logback中配置如下：
&lt;logger name="com.ctrip.framework.apollo" level="info"/> 但是还是需要发版本上线，未免太麻烦，有没有其它办法？
Arthas动态修改日志级别 现在已经有非常成熟的线上调试工具了，Arthas就能实现对Logback的动态日志修改，二话不说，直接机器上修改验证
在问题机器上启动arthas java -jar arthas-boot.jar 选择要处理的应用(10384)进入到arthas
...</p></div><footer class=entry-footer><span title='2022-09-16 15:22:00 +0800 CST'>September 16, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>208 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Apollo不更新配置了？" href=http://blog.imcompany.cn/post/apollo-work-issue/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>那些高效的VSCode插件</h2></header><div class=entry-content><p>必备 vscodevim.vim 在VSCode中使用VIM
angelo-breuer.clock 在状态栏增加时间显示
redguardtoo.matchit Tag匹配，在代码结构中快速跳转
kahole.magit 类Emacs magit
chadalen.vscode-jetbrains-icon-theme 类JetBrains的文件图标
codezombiech.gitignore .ignore文件支持
wmaurer.change-case 快速切换选择单词的格式，支持驼峰，大小写等
lucax88x.codeacejumper 快速跳转到指定字符
NTBBloodbath.doom-one 类Emacs doom-one主题
geeebe.duplicate 复制当前光标中的行，VSCode默认行为增强
usernamehw.errorlens VSCode错误提示增强
zerodind.familiar-java-themes 类Idea主题
vsls-contrib.gistfs Github gist快速查看与编辑
qezhu.gitlink 复制当前文件的仓库地址
trixnz.go-to-method 跳转到指定方法，不包换其它Symbol信息
YuTengjing.open-in-external-app 使用外部应用打开当前文件
tootone.org-mode Emacs org-mode局部支持
mushan.vscode-paste-image 粘贴图片到Markdown
Shan.code-settings-sync VSCode配置多终端同步
mybells.someone-github-stars 获取指定Githuber的Star并写入到Markdown
TabNine.tabnine-vscode TabNine AI代码完成
VSpaceCode.whichkey VSCode按键修改与提示
Office Viewer(Markdown Editor) - Visual Studio Marketplace Captured On: [2023-05-19 Fri 10:08]
...</p></div><footer class=entry-footer><span title='2022-09-05 17:45:00 +0800 CST'>September 5, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>178 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to 那些高效的VSCode插件" href=http://blog.imcompany.cn/post/vscode-plugin/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>用Riggrep进行快速搜索</h2></header><div class=entry-content><p>为什么要学习riggrep? Riggrep快 天下武功，唯快不破
Riggrep聪明 默认会排除 .gitignore/.ignore/.rgignore 文件下的配置和隐藏文件、二进制文件
安装 brew install ripgrep 使用说明 样例所有操作使用 study-sample 仓库，里面是常用语言的入门学习资源，操作文档结构如下：
tree ~/github/study-sample 基本使用 遍历查询 ~/github/study-sample/ 下所有包含 TODO say hello 字符串的结果
rg 'TODO say hello' ~/github/study-sample/ 查询到的结果以 文件 维度进行展示，使用 分号 进行分割，分号前为文件路径，分号后为查询匹配到的内容
只打印路径不打印匹配的内容 如果只关注匹配的文件不关注内容，可以使用 –files-with-match 选项，短选项为 -l
rg -l 'TODO say hello' ~/github/study-sample/ 上述结果只显示了匹配的文件路径，不再包含内容
搜索结果进行排序 为了性能考虑，rg默认搜索结果是无序的，如果想让结果有序，可增加 –sort path 选项
rg -l 'TODO say hello' --sort path ~/github/study-sample/ 上述输出将结果按字母进行排序
搜索不包含指定内容 如果想查询不包含指定内容的文件，可以使用 –files-without-match 选项，此选项无缩写选项
rg --files-without-match 'TODO say hello' --sort path ~/github/study-sample/ 以上结果正好与上一项的搜索结果相反
...</p></div><footer class=entry-footer><span title='2022-08-30 20:01:00 +0800 CST'>August 30, 2022</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>292 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to 用Riggrep进行快速搜索" href=http://blog.imcompany.cn/post/ripgrep-study/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Spring的RedisTemplate如何与Lettuce进行交互的</h2></header><div class=entry-content><p>问题 SpringWebFlux项目，使用的Redis客户端是Lettuce(基于异步)，在Spring中封装了两种操作Redis的模板 RedisTemplate 与 ReactiveRedisTemplate ，正常情况下，异步编程要使用 ReactiveRedisTemplate ，那么可以在项目中使用 RedisTemplate 进行redis的操作吗？为什么？
答案 可以使用 RedisTemplate 在异步代码中进行操作
@Autowried private StringRedisTemplate redisTemplate; String value = redisTemplate.opsForValue().get(key); 追根溯源 先来明确一下应用与Redis的交互流程
Redis交互流程 获取连接 执行命令 返回结果 源码追踪 String value = redisTemplate.opsForValue().get(key); 以下以redis的get命令为例进行解析，get方法是通过 RedisTemplate 的 ValueOperations 属性进行处理的，因为 ValueOperations 是一个接口，要从其实现类 DefaultValueOperations 的get方法进行解析，直接上图
Figure 1: 整体流程图
关键点解析 第1-5步只是为了获取Redis连接
getConnection是为了获取具体的底层redis命令，项目使用Lettuce且为String操作，此处获取的连接为 LettuceStringCommands
第6步是命令执行触发点
它调用了执行DefaultValueOperations.execute(ValueDeserializingRedisCallback)方法调用时方法参数ValueDeserializingRedisCallback的实现方法inRedis，由此转入到真正的命令执行阶段
第9步获取API
LettuceConnection获取的是通过调用StatefulConnection.async()方法获取的异步API
第12步进行返回处理
LettuceConnection的doInvoke方法进行了LettuceInvoker的返回处理，在里面看到的是调用了feture.get()方法使用等待的方式来实现了异步转同步的调用，等待的超时时间通过 spring.redis.timeout 进行配置，默认为6000ms
获取连接阶段与执行命令阶段图示 更近一步，可以把 获取连接阶段 与 执行命令阶段 分开来，看图更加清晰
...</p></div><footer class=entry-footer><span title='2022-06-01 11:04:00 +0800 CST'>June 1, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>73 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Spring的RedisTemplate如何与Lettuce进行交互的" href=http://blog.imcompany.cn/post/spring-redisttemplate-lettuce/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Springwebflux源码学习-服务启动流程</h2></header><div class=entry-content><p>学习目标 理解WebFlux核心组件HttpHandler、WebHandler的创建过程 理解DispatcherHandler如何映射请求url及参数的过程 理解Netty服务的主要启动节点 此次学习的Spring boot版本为2.6.6，对应的Spring webflux版本为5.3.18
入口 Springboot工程入口方法为 SpringApplication.run() ，从此方法开始进行分析。
public static void main(String[] args) { SpringApplication.run(Main.class, args); } 决定启动的web应用类型 整个服务的web应用类型是在构造 SpringApplication 类时进行确定的，具体代码如下：
this.webApplicationType = WebApplicationType.deduceFromClasspath(); 判断应用类型的逻辑 org.springframework.web.reactive.DispatcherHandler存在 org.springframework.web.servlet.DispatcherServlet不存在 org.glassfish.jersey.servlet.ServletContainer不存在 即确认webApplicationType为 Reactive
if (ClassUtils.isPresent(WEBFLUX_INDICATOR_CLASS, null) && !ClassUtils.isPresent(WEBMVC_INDICATOR_CLASS, null) && !ClassUtils.isPresent(JERSEY_INDICATOR_CLASS, null)) { return WebApplicationType.REACTIVE; } 创建具体的ApplicationContext 根据webApplicationType(Reactive)确定创建的ApplicationContext为AnnotationConfigReactiveWebServerApplicationContext，此Context支持 @Component 和 JSR-330规范中 @Inject 形式的依赖注解
SpringAplication.createApplicationContext() switch (webApplicationType) { case SERVLET: return new AnnotationConfigServletWebServerApplicationContext(); case REACTIVE: return new AnnotationConfigReactiveWebServerApplicationContext(); default: return new AnnotationConfigApplicationContext(); } 最主要的ApplicationContext.refresh()方法 refresh的Refresh阶段 刷新操作是在 AbstractApplicationContext 类的refresh方法中进行，在调用invokeBeanFactoryPostProcessors方法时会有对controller注解的扫描与处理
...</p></div><footer class=entry-footer><span title='2022-05-24 17:37:00 +0800 CST'>May 24, 2022</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>351 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Springwebflux源码学习-服务启动流程" href=http://blog.imcompany.cn/post/springwebflux-start/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>开发中会遇到的Maven问题解惑</h2></header><div class=entry-content><p>多模块系统版本控制问题 在开发想保持项目下的所有子模块版本一致，可以使用${rversion}变量
配置父pom &lt;groupId>cn.imcompany&lt;/groupId> &lt;artifactId>big-parent&lt;/artifactId> &lt;version>${revision}&lt;/version> &lt;packaging>pom&lt;/packaging> &lt;modules> &lt;module>big-web&lt;/module> &lt;/modules> &lt;properties> &lt;revision>1.0.0&lt;/revision> &lt;/properties> 子模块配置 &lt;parent> &lt;groupId>cn.imcompany&lt;/groupId> &lt;artifactId>big-parent&lt;/artifactId> &lt;version>${revision}&lt;/version> &lt;/parent> &lt;artifactId>big-web&lt;/artifactId> 修改版本方式 直接修改revision变量的值 使用 mvn clean package -Drevision=1.1.0 进行配置 使用revision后Deploy操作不显示正确版本问题 需要配合 Flatten Maven Plugin 即可解决，父pom中需要增加以下配置：
&lt;build> &lt;plugins> &lt;plugin> &lt;groupId>org.codehaus.mojo&lt;/groupId> &lt;artifactId>flatten-maven-plugin&lt;/artifactId> &lt;version>1.2.2&lt;/version> &lt;configuration> &lt;updatePomFile>true&lt;/updatePomFile> &lt;/configuration> &lt;executions> &lt;execution> &lt;id>flatten&lt;/id> &lt;phase>process-resources&lt;/phase> &lt;goals> &lt;goal>flatten&lt;/goal> &lt;/goals> &lt;/execution> &lt;execution> &lt;id>flatten.clean&lt;/id> &lt;phase>clean&lt;/phase> &lt;goals> &lt;goal>clean&lt;/goal> &lt;/goals> &lt;/execution> &lt;/executions> &lt;/plugin> &lt;/plugins> &lt;/build> 配置指定项目不发布到远程仓库 在新版本的deploy插件已经支持配置，配置skip变量即可
&lt;plugin> &lt;groupId>org.apache.maven.plugins&lt;/groupId> &lt;artifactId>maven-deploy-plugin&lt;/artifactId> &lt;version>3.0.0-M2&lt;/version> &lt;configuration> &lt;skip>true&lt;/skip> &lt;/configuration> &lt;/plugin> Reference Maven: POM files without a version in it? - SoftwareEntwicklung Beratung Schulung</p></div><footer class=entry-footer><span title='2022-04-07 19:30:00 +0800 CST'>April 7, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>85 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to 开发中会遇到的Maven问题解惑" href=http://blog.imcompany.cn/post/maven-case/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Linux代码结构学习</h2></header><div class=entry-content><p>Linux代码结构 准备学习Linux，看源码是少不了的，先对Linux源码有个大体认识(基于linux4.13)
代码主要文件解析 Makefile 这是整个源码的Makefile，里面定义了一系列的变量和规则，比如默认的gcc编译flag。
Documentation/ 项目文档，里面包含了很多关于配置内核、与ramdisk运行等有用的信息。这里面没有不同配置项的帮助信息，这些信息可以在相关子目录的 Kconfig 文件中查看。
arch/ 体系结构相关代码都在这里，还有一部分在include/arch-generic中。每个体系结构在这个目录下都有一个子目录。比如基于x86体系的代码都在 arch/x86 下。另外，这个目录下还包含低级别的内存管理，中断处理，早期初始化，汇编库等信息。
crypto/ 内核使用的加密API代码。
drivers/ 所有设备相关的信息都在这个目录下。包括视频设备，网卡设备，低级别的SCSI设备。比如网络设备一般是在 drivers/net 目录下。
fs/ 通用的文件系统与其它类型的文件系统代码都在这里。现在的操作系统的根文件系统一般为ext4格式，它的代码在 fs/ext4 下
include/ 所有.c文件中包含的头文件都定义在这个目录下。
init/ 这个目录包含了内核启动的入口文件 main.c ，版本信息文件 version.c 和早期用户空间相关的代码，早期空间代码提供内核出现时的功能，它不需要在内核中进行运行。
ipc/ 进程间通信相关代码，包含共享内存，信号量等信息。
kernel/ 内核级别代码，上层的系统调用代码在这里，还有关于 printk() 代码，调度，信号量处理的代码。
lib/ 内核所有使用的库都在这里。常见的字符串运算，调试库，命令行解析代码等。
mm/ 高级别的内存管理代码。虚拟内存是通过这些库与低级别的体系结构代码(在 arch/&lt;arch>/mm )一同实现的。这里完成了早期引导内存管理，涉及文件的内存映射，页缓存的管理，内存分配和RAM中页面的交换。
net/ 高级别的网络代码。与低级别的网络进行发包与收包交互。*net/core* 中包含其它网络协议使用的核心代码。net子目录就是特定的网络协议实现。
scripts/ 这里面包含构建内核的脚本文件。
security/ 不同Linux的安全模型代码。
sound/ 声卡及相关代码在这里。
usr/ 该目录包含构建根文件系统映射的cpio格式的文档代码，该文档用于早期的用户空间。
Reference 08 Overview of the Kernel Source | LinuxChix Courses</p></div><footer class=entry-footer><span title='2022-04-06 18:53:00 +0800 CST'>April 6, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>64 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to Linux代码结构学习" href=http://blog.imcompany.cn/post/linux-source/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>记一次SpringWebflux框架下堆外OOM排查经历</h2></header><div class=entry-content><p>症状 生产环境业务页面打不开，看错误日志是 OutOfDirectMemoryError (OOM)了，详情报错信息如下：
2022-03-21 06:00:00.541 [,] [tafprx-asyrecv_9] ERROR r.c.p.Operators - [error,314] - Operator called default onErrorDropped java.lang.OutOfMemoryError: Direct buffer memory at java.base/java.nio.Bits.reserveMemory(Bits.java:175) at java.base/java.nio.DirectByteBuffer.&lt;init>(DirectByteBuffer.java:118) at java.base/java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:317) at io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:632) at io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:607) at io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202) at io.netty.buffer.PoolArena.tcacheAllocateSmall(PoolArena.java:172) at io.netty.buffer.PoolArena.allocate(PoolArena.java:134) at io.netty.buffer.PoolArena.allocate(PoolArena.java:126) at io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:395) at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:187) at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:178) at io.netty.buffer.AbstractByteBufAllocator.buffer(AbstractByteBufAllocator.java:115) at org.springframework.core.io.buffer.NettyDataBufferFactory.allocateBuffer(NettyDataBufferFactory.java:71) at org.springframework.core.io.buffer.NettyDataBufferFactory.allocateBuffer(NettyDataBufferFactory.java:39) at org.springframework.http.codec.json.AbstractJackson2Encoder.encodeValue(AbstractJackson2Encoder.java:236) at org.springframework.http.codec.json.AbstractJackson2Encoder.lambda$encode$0(AbstractJackson2Encoder.java:150) at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:113) at reactor.core.publisher.Operators$MonoSubscriber.complete(Operators.java:1815) at reactor.core.publisher.MonoCompletionStage.lambda$subscribe$0(MonoCompletionStage.java:82) at java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:859) at java.base/java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:883) at java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2251) at java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:143) at reactor.core.publisher.MonoCompletionStage.subscribe(MonoCompletionStage.java:57) at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64) at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:157) at reactor.core.publisher.Operators$MonoSubscriber.complete(Operators.java:1815) at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:249) at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79) at reactor.core.publisher.FluxPeek$PeekSubscriber.onNext(FluxPeek.java:199) at reactor.core.publisher.FluxPeek$PeekSubscriber.onNext(FluxPeek.java:199) at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.complete(MonoIgnoreThen.java:284) at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onNext(MonoIgnoreThen.java:187) at reactor.core.publisher.Operators$MonoSubscriber.complete(Operators.java:1815) at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:151) 根据报错的堆栈，找到 AbstractJackson2Encoder:236 行，调试发现框架使用的buffer在最后都进行了释放，看着没问题。
...</p></div><footer class=entry-footer><span title='2022-03-31 20:12:23 +0800 CST'>March 31, 2022</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>615 words</span>&nbsp;·&nbsp;<span>tomyli</span></footer><a class=entry-link aria-label="post link to 记一次SpringWebflux框架下堆外OOM排查经历" href=http://blog.imcompany.cn/post/springwebflux-leak-bug/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=http://blog.imcompany.cn/page/8/>«&nbsp;Prev&nbsp;
</a><a class=next href=http://blog.imcompany.cn/page/10/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2026 <a href=http://blog.imcompany.cn/>I'm company</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>